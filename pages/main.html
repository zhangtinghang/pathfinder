<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta content="yes" name="apple-mobile-web-app-capable">
		<meta content="yes" name="apple-touch-fullscreen">
		<meta content="telephone=no,email=no" name="format-detection">
		<link rel="stylesheet" href="../css/mui.min.css" />
		<script type="text/javascript" src="../js/zoom/flexible.js" ></script>
		<link rel="stylesheet" href="../css/style.css" />
		<title>列表页</title>
		<style>
			.headRight{
				width: 2.083333rem !important;
				height: 1.013888rem !important;
			}
			#body{
				overflow: hidden;
			}
			.mui-content{
				overflow: hidden;
			}
			.listBox{
				width: 100%;
				margin: 0 auto;
				position:relative;
				transform-style:preserve-3d;
				/*为 3D 转换元素定义透视视图。rotateX旋转X*/
				transform:perspective(800px) rotateX(0deg) rotateY(0deg);
			}
			.listBox ul li{
				list-style:none;
				width:86%;
				height:65%;
				position:absolute;
				bottom:0;left:7%;
				border-radius:5px;
				background-color: rgb(255,255,255);
				transform:translateY(-200px) translateZ(-160px);
				z-index: -1;
			}
		</style>
	</head>
	<body class="body_bg" id="body">
		<header class="headerNav" id="header">
			<img src="../image/return.png" />
			<div class="headerTitle">问题星人</div>
			<img class="headRight" src="../image/main/write.png" />
		</header>
		<div class="mui-content">
			<div class="listBox" id="content">
				<ul>
					<li>1</li>
					<li>2</li>
					<li>3</li>
					<li>4</li>
					<li>5</li>
					<li>6</li>
					<li>7</li>
					<li>8</li>
					<li>9</li>
					<li>10</li>
				</ul>
			</div>
		</div>
			
			<script type="text/javascript" src="../js/mui.min.js" ></script>
			<script type="text/javascript" src="../js/jquery-1.11.0.min.js" ></script>
			<script type="text/javascript">
				//确定header高度
				Hhead = document.getElementById("header").offsetHeight;
				//确定body高度
				var Bh = document.getElementById("body").offsetHeight;
				var listBox = document.getElementById("content");
				//确定容器高度
				listBox.style.height = Bh - Hhead  + 'px';
				//初始化
				mui.init({
				  gestureConfig:{
				   tap: true, //默认为true
				   swipe: true, //默认为true
				   hold:true,//默认为false，不监听
				   release:true//默认为false，不监听
				  }
				});
				//输出匹配元素数量
			var oLs = $('#content ul li').size();
			var ly = 0,ys,p=null,xDeg = 0, yDeg = 0;
					for(var i=oLs-1;i>=0;i--){
						xDeg = -i*100;
						yDeg = -i*100;
						$('#content ul li').eq(i).css({
							//transition设置过渡效果
//							transition:"1s "+(oL-i)*0.15+"s transform,.5s "+(1+oL*0.15)+"s opacity",
							'transform':'translateY('+xDeg+'px) translateZ('+yDeg+'px)'
						});
					}
				document.addEventListener("touchstart",function(event){
					//清除定时器
					var oL = oLs;
					var arrY,My;
					var oLindex = 0;			
					var y1 = event.targetTouches["0"].clientY;
					clearInterval(p);
					for(var t=0;t<oL-1;t++){
							arrY = $("#content ul li").eq(t).css('transform').match (/\d+/g)[14]||'0';
							if(arrY == 0){
								continue;
							}else{
								//取到当前的移动值
								arrY = $("#content ul li").eq(t).css('transform').match (/\d+/g)[14]||'0';
								oLindex = t-1;
								break;
							}
						}
					document.addEventListener('touchmove',function(e){
						e.preventDefault();
							//移动相对距离
						ys = e.touches["0"].clientY - y1;
						y1 = e.touches["0"].clientY;
						ly += ys*0.5;
						var translateIndex = arrY/100;
						console.log(' 当前位置',translateIndex,'当前数目',oLindex);
					for(var i = oL-1-oLindex;i>=oLindex;i--){
						console.log('这是index',i)
						if(i <= oLindex){
							yDeg = 0;
							xDeg = 0;
						}else{
							var y = -i*100;
							var z = -i*100;		
							xDeg = parseFloat(y) + parseFloat(ly);
							yDeg = parseFloat(z) + parseFloat(ly);
	//						console.log(xDeg,yDeg)
							//当移动和缩放达到最大时，禁止缩放和移动
							if(yDeg >= 0){
								yDeg = 0;
								xDeg = 0;
							}
							//当第一个元素位置小于0时，禁止改变
							if(y == 0){
								if(xDeg < 0){
									for(var i=oL-1;i>=0;i--){
										xDeg = -i*100;
										yDeg = -i*100;
										$('#content ul li').eq(i).css({
											//transition设置过渡效果
				//							transition:"1s "+(oL-i)*0.15+"s transform,.5s "+(1+oL*0.15)+"s opacity",
											'transform':'translateY('+xDeg+'px) translateZ('+yDeg+'px)'
										});
									}
								}
							}else{
								$('#content ul li').eq(i).css({
								//transition设置过渡效果
	//							transition:"1s "+(oL-i)*0.15+"s transform,.5s "+(1+oL*0.15)+"s opacity",
								'transform':'translateY('+xDeg+'px) translateZ('+yDeg+'px)'
							});
							}
							//当最后一个元素显示在界面上时，禁止再移动下来
							if(i == oL-1){
								if(yDeg >= -300){
									yDeg = -300;
									var yDeg1 = -200, yDeg2 = -100, yDeg3 = 0;
									$('#content ul li').eq(i).css({
											//transition设置过渡效果
				//							transition:"1s "+(oL-i)*0.15+"s transform,.5s "+(1+oL*0.15)+"s opacity",
											'transform':'translateY('+yDeg+'px) translateZ('+yDeg+'px)'
									});
									$('#content ul li').eq(i-1).css({
											//transition设置过渡效果
				//							transition:"1s "+(oL-i)*0.15+"s transform,.5s "+(1+oL*0.15)+"s opacity",
											'transform':'translateY('+yDeg1+'px) translateZ('+yDeg1+'px)'
									});
									$('#content ul li').eq(i-2).css({
											//transition设置过渡效果
				//							transition:"1s "+(oL-i)*0.15+"s transform,.5s "+(1+oL*0.15)+"s opacity",
											'transform':'translateY('+yDeg2+'px) translateZ('+yDeg2+'px)'
									});
									$('#content ul li').eq(i-3).css({
											//transition设置过渡效果
				//							transition:"1s "+(oL-i)*0.15+"s transform,.5s "+(1+oL*0.15)+"s opacity",
											'transform':'translateY('+yDeg3+'px) translateZ('+yDeg3+'px)'
									});
									return false;
								}
							}						
						}

					
					}
					for(var t=0;t<oL-1;t++){
							arrY = $("#content ul li").eq(t).css('transform').match (/\d+/g)[14]||'0';
							if(arrY == 0){
								continue;
							}else{
								//取到当前的移动值
								arrY = $("#content ul li").eq(t).css('transform').match (/\d+/g)[14]||'0';
								oLindex = t-1;
								break;
							}
						}
					})
					
					document.addEventListener("touchend",function(eve){
						//设置阻尼系数 Math.abs绝对值
//						p = setInterval(function(){
//							if(Math.abs(xs)<0.5&&Math.abs(ys)<0.5){clearInterval(p)};
//								xs = xs*0.95;
//								ys = ys*0.95
//								xDeg += xs*0.3;
//								yDeg -= ys*0.1;
//								$('#wrap').css('transform',"perspective(800px) rotateX("+yDeg+"deg) rotateY("+xDeg+"deg)");
//							},30);
					})
				});
				
				// H5 plus事件处理
				function plusReady(){
//					console.log( "Screen height: " + plus.screen.resolutionHeight*plus.screen.scale + "px" );
//					console.log( "Screen resolution: " + plus.screen.resolutionWidth*plus.screen.scale + " x " + plus.screen.resolutionHeight*plus.screen.scale );
//					console.log( "物理: " + plus.screen.resolutionWidth + " x " + plus.screen.resolutionHeight);
//					console.log( "放大比例系数: " + plus.screen.scale);
				}
				if(window.plus){
					plusReady();
				}else{
					document.addEventListener("plusready",plusReady,false);
				}
	</script>
	</body>
</html>
