<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta content="yes" name="apple-mobile-web-app-capable">
		<meta content="yes" name="apple-touch-fullscreen">
		<meta content="telephone=no,email=no" name="format-detection">
		<link rel="stylesheet" href="../css/mui.min.css" />
		<script type="text/javascript" src="../js/zoom/flexible.js" ></script>
		<link rel="stylesheet" href="../css/style.css" />
		<style>
			.headRight{
				width: 2.055555rem;
				height: 0.97777rem;
				color: rgba(255,255,255,1);
				display: flex;
				justify-content: center;
				align-items: center;
				font-size: 0.5rem;
			}
			
			.avatar_box{
				align-items: center;
				justify-content: center;
				text-align: center;
			}
			.content_avatar{
				height:2.777777rem;
				width:2.777777rem;				
				margin: 0.577777rem auto;
				margin-top: 0.977777rem;
			}
			.content_avatar img{
				width: 100%;
				height: 100%;
			}
			.header_title{
				font-size: 0.5rem;
				color: rgba(255,255,255,1);
			}
			.nickname{
				color: rgba(255,255,255,0.25);
				font-size: 0.5rem;
				margin-left: 15%;
				padding: 10px 0;
			}
			.input{
				margin-bottom: 1.047222rem !important;
				width: 80% !important;
				margin-left:10%;
				border-radius:10px !important;
				background-color: rgba(255,255,255,0.06) !important;
				color: rgba(255,255,255,1);
				font-size: 0.5rem;
			}
		</style>
	</head>

	<body class="body_bg">
		<header class="headerNav" id="header">
			<img class="mui-action-back" src="../image/return.png" />
			<div class="headerTitle">确认身份</div>
			<div class="headRight" id="comeBtn">确定</div>
		</header>
		<div class="content">
			<div class="avatar_box">
				<div class="content_avatar">
					<img id="head-avatar" />
				</div>
			</div>
			<div class="content_body">
				<div class="nickname">昵称</div>
				<input class="input nicknameInput" type="text" id="head-nickname" />
				<div class="nickname">用一句话介绍自己：</div>
				<textarea class="input bodyInput" id="head-description"></textarea>
			</div>
		</div>
		<script src="../js/mui.min.js"></script>
		<script type="text/javascript" src="../login/JS/app.js" ></script>
		<script type="text/javascript" src="../js/ajax.js" ></script>
		<script type="text/javascript" src="../js/ajax.config.js" ></script>
		<script type="text/javascript">
			mui.init({
				beforeback: function(){
					//获得列表界面的webview
					var content = plus.webview.getWebviewById('personal');
					//触发列表界面的自定义事件（refresh）,从而进行数据刷新
					mui.fire(content,'changPersonal',{
						id:"刷新"
					});
					//返回true，继续页面关闭逻辑
					return true;
				}
			})
			
			var state = app.getState();
			//获取数据 绑定		
			var headerObj = {
				avatar : document.getElementById("head-avatar"),
				nickname : document.getElementById("head-nickname"),
				description:document.getElementById("head-description")
			}
				if(state.user.avatar){
					headerObj.avatar.src = state.user.avatar;
				}else{
					headerObj.avatar.src = '../image/personal/set-head.png';
				}
				if(state.user.nickname){
					headerObj.nickname.value = state.user.nickname;
				}else{
					headerObj.nickname.value = 'none';
				}
				if(state.user.description){
					headerObj.description.value = state.user.description;
				}else{
					headerObj.description.placeholder = '简介';
				}
				
			//点击确定按钮
			document.getElementById("comeBtn").addEventListener('tap',function(){
				if(headerObj.nickname ==''){
					return plus.nativeUI.toast('昵称不能为空！')
				}
				//头像
				var ajaxData = {
					url: 'user/alter',
					data: {
						token: state.token,
						nickname:headerObj.nickname.value,
						description:headerObj.description.value
					},
					type: 'post'
				}
				ajax(ajaxData, function(data) {
					console.log(JSON.stringify(data))
					if(data.success == true){
						//获取最新数据 并且更新到本地配置
						UpdataUser(state,function(save){
							if(save.success == true){
								mui.back();
							}else{
								plus.nativeUI.toast('更新数据出错，请重新提交！')
							}
						})
					}else{
						plus.nativeUI.toast('提交失败，请稍后再试！')
					}
				});	
			})
		</script>
	</body>

</html>